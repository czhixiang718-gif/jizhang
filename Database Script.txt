const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('database.sqlite');

db.serialize(() => {
    console.log("Initializing database...");
    
    // 清空旧表 (可选)
    // db.run("DROP TABLE IF EXISTS payments");
    // db.run("DROP TABLE IF EXISTS projects");

    // 创建表
    db.run(`CREATE TABLE IF NOT EXISTS projects (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        entity TEXT,
        invoiceInfo TEXT,
        signDate TEXT,
        paymentDate TEXT,
        manager TEXT,
        contact TEXT,
        amount REAL,
        status TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )`);

    db.run(`CREATE TABLE IF NOT EXISTS payments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        project_id INTEGER,
        date TEXT,
        amount REAL,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY(project_id) REFERENCES projects(id) ON DELETE CASCADE
    )`);

    console.log("Database setup complete.");
});

db.close();